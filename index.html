<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flappy Bird</title>
  <style>
    body { margin: 0; background: #70c5ce; font-family: Arial; }
    canvas { display: block; margin: auto; background: #70c5ce; }
    #menu, #settings, #login { text-align: center; margin-top: 20px; }
    button { margin: 5px; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h2 style="text-align:center;">ğŸ¤ Flappy Bird</h2>

  <!-- ÄÄƒng nháº­p -->
  <div id="login">
    <h3>ÄÄƒng nháº­p / ÄÄƒng kÃ½</h3>
    <input id="username" placeholder="TÃªn tÃ i khoáº£n"><br><br>
    <input id="password" type="password" placeholder="Máº­t kháº©u"><br><br>
    <button onclick="register()">ÄÄƒng kÃ½</button>
    <button onclick="login()">ÄÄƒng nháº­p</button>
    <p id="loginMsg"></p>
  </div>

  <!-- Menu chÃ­nh -->
  <div id="menu" style="display:none;">
    <p id="welcome"></p>
    <button onclick="startGame()">ChÆ¡i ngay</button>
    <button onclick="openSettings()">âš™ï¸ CÃ i Ä‘áº·t</button>
    <p>Äiá»ƒm cao nháº¥t: <span id="highScore">0</span></p>
  </div>

  <!-- CÃ i Ä‘áº·t -->
  <div id="settings" style="display:none;">
    <h3>CÃ i Ä‘áº·t tá»‘c Ä‘á»™</h3>
    <label>Tá»‘c Ä‘á»™ á»‘ng: <input type="number" id="pipeSpeed" value="2"></label>
    <br><br>
    <button onclick="saveSettings()">LÆ°u</button>
    <button onclick="backMenu()">Trá»Ÿ vá» Menu</button>
  </div>

  <!-- Game -->
  <canvas id="gameCanvas" width="400" height="600" style="display:none;"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let bird, pipes, frame, score, pipeSpeed = 2;
    let currentUser = null;

    // ============ QUáº¢N LÃ TÃ€I KHOáº¢N ============
    function register() {
      const user = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value.trim();
      if (!user || !pass) return alert("Nháº­p Ä‘á»§ tÃ i khoáº£n vÃ  máº­t kháº©u!");

      if (localStorage.getItem("user_" + user)) {
        alert("TÃ i khoáº£n Ä‘Ã£ tá»“n táº¡i!");
        return;
      }

      localStorage.setItem("user_" + user, JSON.stringify({ password: pass, highScore: 0 }));
      alert("ÄÄƒng kÃ½ thÃ nh cÃ´ng! HÃ£y Ä‘Äƒng nháº­p.");
    }

    function login() {
      const user = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value.trim();
      if (!user || !pass) return alert("Nháº­p Ä‘á»§ tÃ i khoáº£n vÃ  máº­t kháº©u!");

      const data = localStorage.getItem("user_" + user);
      if (!data) {
        alert("ChÆ°a cÃ³ tÃ i khoáº£n, hÃ£y Ä‘Äƒng kÃ½!");
        return;
      }

      const userData = JSON.parse(data);
      if (userData.password !== pass) {
        alert("Sai máº­t kháº©u!");
        return;
      }

      currentUser = user;
      document.getElementById("login").style.display = "none";
      document.getElementById("menu").style.display = "block";
      document.getElementById("welcome").innerText = "Xin chÃ o, " + user;
      loadHighScore();
    }

    function loadHighScore() {
      if (!currentUser) return;
      const data = JSON.parse(localStorage.getItem("user_" + currentUser));
      document.getElementById("highScore").innerText = data.highScore;
    }

    function saveHighScore() {
      if (!currentUser) return;
      const data = JSON.parse(localStorage.getItem("user_" + currentUser));
      if (score > data.highScore) {
        data.highScore = score;
        localStorage.setItem("user_" + currentUser, JSON.stringify(data));
        loadHighScore();
      }
    }

    // ============ GAME ============
    function startGame() {
      document.getElementById("menu").style.display = "none";
      canvas.style.display = "block";

      bird = { x: 50, y: 150, width: 20, height: 20, gravity: 0.6, lift: -10, velocity: 0 };
      pipes = [];
      frame = 0;
      score = 0;

      update();
    }

    function drawBird() {
      ctx.fillStyle = "yellow";
      ctx.fillRect(bird.x, bird.y, bird.width, bird.height);
    }

    function drawPipes() {
      ctx.fillStyle = "green";
      for (let p of pipes) {
        ctx.fillRect(p.x, 0, p.width, p.top);
        ctx.fillRect(p.x, canvas.height - p.bottom, p.width, p.bottom);
      }
    }

    function drawScore() {
      ctx.fillStyle = "black";
      ctx.font = "24px Arial";
      ctx.fillText("Score: " + score, 10, 30);
    }

    function update() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      bird.velocity += bird.gravity;
      bird.y += bird.velocity;

      if (bird.y + bird.height > canvas.height || bird.y < 0) {
        gameOver();
        return;
      }

      if (frame % 90 === 0) {
        let pipeHeight = Math.floor(Math.random() * 200) + 50;
        let gap = 120;
        pipes.push({
          x: canvas.width,
          width: 40,
          top: pipeHeight,
          bottom: canvas.height - pipeHeight - gap
        });
      }

      for (let i = pipes.length - 1; i >= 0; i--) {
        let p = pipes[i];
        p.x -= pipeSpeed;

        if (bird.x < p.x + p.width &&
            bird.x + bird.width > p.x &&
            (bird.y < p.top || bird.y + bird.height > canvas.height - p.bottom)) {
          gameOver();
          return;
        }

        if (p.x + p.width < 0) {
          pipes.splice(i, 1);
          score++;
        }
      }

      drawBird();
      drawPipes();
      drawScore();

      frame++;
      requestAnimationFrame(update);
    }

    function gameOver() {
      saveHighScore();
      alert("Game Over! Äiá»ƒm cá»§a báº¡n: " + score);
      canvas.style.display = "none";
      document.getElementById("menu").style.display = "block";
    }

    document.addEventListener("keydown", () => {
      bird.velocity = bird.lift;
    });

    // ============ CÃ€I Äáº¶T ============
    function openSettings() {
      document.getElementById("menu").style.display = "none";
      document.getElementById("settings").style.display = "block";
    }

    function saveSettings() {
      pipeSpeed = parseInt(document.getElementById("pipeSpeed").value);
      if (isNaN(pipeSpeed) || pipeSpeed <= 0) pipeSpeed = 2;
      alert("ÄÃ£ lÆ°u cÃ i Ä‘áº·t!");
    }

    function backMenu() {
      document.getElementById("settings").style.display = "none";
      document.getElementById("menu").style.display = "block";
    }
  </script>
</body>
</html>
